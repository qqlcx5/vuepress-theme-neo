{"version":3,"file":"BingHeroBackground.js","sourceRoot":"","sources":["../../src/presets/BingHeroBackground.ts"],"names":[],"mappings":"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","sourcesContent":["import { onClickOutside, useStorage } from \"@vueuse/core\";\nimport type { VNode } from \"vue\";\nimport {\n  Transition,\n  computed,\n  defineComponent,\n  h,\n  onMounted,\n  ref,\n  shallowRef,\n} from \"vue\";\nimport { ClientOnly, usePageLang } from \"vuepress/client\";\n\nimport \"./bing-hero-background.scss\";\n\ninterface BingWallpaperInfo {\n  url: string;\n  wallpaper: string;\n  downloadable: boolean;\n  locales: Record<\n    string,\n    {\n      title: string;\n      description: string;\n      headline: string;\n      copyright: string;\n      backstage: string;\n      quickFact: string;\n    }\n  >;\n}\nconst bingStorage = useStorage<{\n  index: number;\n  data: BingWallpaperInfo[];\n}>(\"bing-image\", {\n  index: 0,\n  data: [],\n});\n\nexport default defineComponent({\n  name: \"BingHeroBackground\",\n\n  /*\n   * TODO: Add download button\n   * props: {\n   *   download: Boolean,\n   * },\n   */\n\n  setup() {\n    const lang = usePageLang();\n    const bingInfo = shallowRef<HTMLElement>();\n    const showInfo = ref(false);\n\n    const currentWallpaper = computed(() => {\n      const { index, data } = bingStorage.value;\n\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      const langCode = lang.value.toLowerCase().split(\"-\").shift()!;\n\n      if (data[index]) {\n        const { url, wallpaper, downloadable, locales } = data[index];\n\n        return {\n          url,\n          wallpaper,\n          downloadable,\n          ...(locales[langCode] ?? locales.en),\n        };\n      }\n\n      return null;\n    });\n\n    const getImage = (): Promise<BingWallpaperInfo[]> =>\n      fetch(\"https://bing-wallpaper.vuejs.press/api/wallpaper\").then(\n        (response) => response.json() as Promise<BingWallpaperInfo[]>,\n      );\n\n    const prev = (): void => {\n      bingStorage.value.index -= 1;\n    };\n\n    const next = (): void => {\n      bingStorage.value.index += 1;\n    };\n\n    onClickOutside(bingInfo, () => {\n      showInfo.value = false;\n    });\n\n    onMounted(() => {\n      void getImage().then((res) => {\n        bingStorage.value.data = res;\n      });\n    });\n\n    return (): VNode => {\n      const { title, headline, url, backstage, quickFact, copyright } =\n        currentWallpaper.value ?? {};\n\n      return h(ClientOnly, () =>\n        url\n          ? [\n              h(\"div\", {\n                class: \"vp-blog-mask\",\n                style: {\n                  background: `url(${url}) center/cover no-repeat`,\n                },\n              }),\n              h(\n                \"div\",\n                {\n                  class: \"bing-switch\",\n                  onClick: () => {\n                    showInfo.value = true;\n                  },\n                },\n                [\n                  h(Transition, { name: \"fade\" }, () =>\n                    showInfo.value\n                      ? h(\"div\", { class: \"bing-info\", ref: bingInfo }, [\n                          h(\n                            \"a\",\n                            {\n                              href: backstage,\n                              target: \"_blank\",\n                              class: \"bing-info-header\",\n                            },\n                            headline,\n                          ),\n                          h(\"hr\"),\n                          h(\"div\", { class: \"bing-info-body\" }, quickFact),\n                          h(\"div\", { class: \"bing-info-copyright\" }, copyright),\n                        ])\n                      : null,\n                  ),\n                  h(\"div\", { class: \"bing-location\" }, [\n                    h(\"span\", { class: \"bing-location-icon\" }),\n                    title,\n                  ]),\n\n                  h(\"button\", {\n                    class: \"bing-switch-prev\",\n                    title: \"prev image\",\n                    type: \"button\",\n                    disabled: bingStorage.value.index === 0,\n                    onClick: () => {\n                      prev();\n                    },\n                  }),\n                  h(\"button\", {\n                    class: \"bing-switch-next\",\n                    title: \"next image\",\n                    type: \"button\",\n                    disabled:\n                      bingStorage.value.index ===\n                      bingStorage.value.data.length - 1,\n                    onClick: () => {\n                      next();\n                    },\n                  }),\n                ],\n              ),\n            ]\n          : null,\n      );\n    };\n  },\n});\n"]}