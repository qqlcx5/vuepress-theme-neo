{"version":3,"file":"useRelatedLinks.js","sourceRoot":"","sources":["../../../src/client/composables/useRelatedLinks.ts"],"names":[],"mappings":"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","sourcesContent":["import { isPlainObject, isString } from \"@vuepress/helper/client\";\nimport type { ComputedRef } from \"vue\";\nimport { computed } from \"vue\";\nimport { resolveRoute, usePageFrontmatter, useRoute } from \"vuepress/client\";\n\nimport { useSidebarItems } from \"@theme-hope/modules/sidebar/composables/index\";\nimport type { SidebarItem } from \"@theme-hope/modules/sidebar/utils/index\";\nimport { resolveLinkInfo } from \"@theme-hope/utils/index\";\n\nimport { useThemeLocaleData } from \"./useThemeData.js\";\nimport type {\n  AutoLinkOptions,\n  ThemeNormalPageFrontmatter,\n} from \"../../shared/index.js\";\n\nconst resolveFromFrontmatterConfig = (\n  config: unknown,\n  currentPath: string,\n): AutoLinkOptions | null | false =>\n  config === false\n    ? config\n    : isPlainObject<AutoLinkOptions>(config)\n      ? {\n          ...config,\n          link: resolveLinkInfo(config.link, true, currentPath).link,\n        }\n      : isString(config)\n        ? resolveLinkInfo(config, true, currentPath)\n        : null;\n\n/**\n * Resolve `prev` or `next` config from sidebar items\n */\nconst resolveFromSidebarItems = (\n  sidebarItems: SidebarItem[],\n  currentPath: string,\n  offset: number,\n): AutoLinkOptions | null => {\n  const linkIndex = sidebarItems.findIndex((item) => item.link === currentPath);\n\n  if (linkIndex !== -1) {\n    if (!sidebarItems[linkIndex + offset]) return null;\n\n    const targetItem = sidebarItems[linkIndex + offset];\n\n    if (targetItem.link) return targetItem as AutoLinkOptions;\n\n    if (\"prefix\" in targetItem && !resolveRoute(targetItem.prefix).notFound)\n      return {\n        ...targetItem,\n        link: targetItem.prefix,\n      };\n\n    return null;\n  }\n\n  for (const item of sidebarItems)\n    if (\"children\" in item) {\n      const childResult = resolveFromSidebarItems(\n        item.children,\n        currentPath,\n        offset,\n      );\n\n      if (childResult) return childResult;\n    }\n\n  const prefixIndex = sidebarItems.findIndex(\n    (item) => \"prefix\" in item && item.prefix === currentPath,\n  );\n\n  if (prefixIndex !== -1) {\n    if (!sidebarItems[prefixIndex + offset]) return null;\n\n    const targetItem = sidebarItems[prefixIndex + offset];\n\n    if (targetItem.link) return targetItem as AutoLinkOptions;\n\n    if (\"prefix\" in targetItem && !resolveRoute(targetItem.prefix).notFound)\n      return {\n        ...targetItem,\n        link: targetItem.prefix,\n      };\n\n    return null;\n  }\n\n  return null;\n};\n\ninterface RelatedLinks {\n  prevLink: ComputedRef<AutoLinkOptions | null>;\n  nextLink: ComputedRef<AutoLinkOptions | null>;\n}\n\nexport const useRelatedLinks = (): RelatedLinks => {\n  const frontmatter = usePageFrontmatter<ThemeNormalPageFrontmatter>();\n  const themeLocale = useThemeLocaleData();\n  const sidebarItems = useSidebarItems();\n  const route = useRoute();\n\n  const prevLink = computed(() => {\n    const prevConfig = resolveFromFrontmatterConfig(\n      frontmatter.value.prev,\n      route.path,\n    );\n\n    return prevConfig === false\n      ? null\n      : (prevConfig ??\n          (themeLocale.value.prevLink === false\n            ? null\n            : resolveFromSidebarItems(sidebarItems.value, route.path, -1)));\n  });\n\n  const nextLink = computed(() => {\n    const nextConfig = resolveFromFrontmatterConfig(\n      frontmatter.value.next,\n      route.path,\n    );\n\n    return nextConfig === false\n      ? null\n      : (nextConfig ??\n          (themeLocale.value.nextLink === false\n            ? null\n            : resolveFromSidebarItems(sidebarItems.value, route.path, 1)));\n  });\n\n  return {\n    prevLink,\n    nextLink,\n  };\n};\n"]}