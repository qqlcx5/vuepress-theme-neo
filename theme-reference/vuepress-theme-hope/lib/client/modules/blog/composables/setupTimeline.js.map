{"version":3,"file":"setupTimeline.js","sourceRoot":"","sources":["../../../../../src/client/modules/blog/composables/setupTimeline.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,OAAO,EAAE,MAAM,yBAAyB,CAAC;AAElD,OAAO,EAAE,WAAW,EAAE,MAAM,8BAA8B,CAAC;AAE3D,OAAO,EAAE,QAAQ,EAAE,MAAM,EAAE,OAAO,EAAE,MAAM,KAAK,CAAC;AAChD,OAAO,EAAE,WAAW,EAAE,MAAM,iBAAiB,CAAC;AAG9C,OAAO,EAAE,WAAW,EAAE,MAAM,6BAA6B,CAAC;AAe1D,MAAM,CAAC,MAAM,cAAc,GAA8B,MAAM,CAC7D,gBAAgB,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,EAAE,CACnC,CAAC;AAEF;;GAEG;AACH,MAAM,CAAC,MAAM,WAAW,GAAG,GAAgB,EAAE;IAC3C,MAAM,QAAQ,GAAG,MAAM,CAAC,cAAc,CAAC,CAAC;IAExC,IAAI,CAAC,QAAQ;QAAE,MAAM,IAAI,KAAK,CAAC,2CAA2C,CAAC,CAAC;IAE5E,OAAO,QAAQ,CAAC;AAClB,CAAC,CAAC;AAEF;;GAEG;AACH,MAAM,CAAC,MAAM,aAAa,GAAG,GAAS,EAAE;IACtC,MAAM,QAAQ,GAAG,WAAW,CAAkB,UAAU,CAAC,CAAC;IAC1D,MAAM,QAAQ,GAAG,WAAW,EAAE,CAAC;IAE/B,MAAM,aAAa,GAAG,QAAQ,CAAC,GAAG,EAAE;QAClC,MAAM,aAAa,GAAmB,EAAE,CAAC;QAEzC,qBAAqB;QACrB,QAAQ,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,EAAE,EAAE;YAC9C,MAAM,MAAM,GAAG,OAAO,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC;YAE/C,IAAI,MAAM,EAAE,CAAC;gBACX,MAAM,IAAI,GAAG,MAAM,CAAC,WAAW,EAAE,CAAC;gBAElC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,aAAa,CAAC,CAAC,CAAC,CAAC,IAAI,KAAK,IAAI;oBACrD,aAAa,CAAC,OAAO,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC,CAAC;gBAE7C,aAAa,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC;oBAC1B,IAAI,EAAE,MAAM,CAAC,kBAAkB,CAAC,QAAQ,CAAC,KAAK,EAAE;wBAC9C,KAAK,EAAE,SAAS;wBAChB,GAAG,EAAE,SAAS;qBACf,CAAC;oBACF,IAAI;oBACJ,IAAI;iBACL,CAAC,CAAC;YACL,CAAC;QACH,CAAC,CAAC,CAAC;QAEH,OAAO;YACL,GAAG,QAAQ,CAAC,KAAK;YACjB,MAAM,EAAE,aAAa,CAAC,OAAO,EAAE;SAChC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,OAAO,CAAC,cAAc,EAAE,aAAa,CAAC,CAAC;AACzC,CAAC,CAAC","sourcesContent":["import { getDate } from \"@vuepress/helper/client\";\nimport type { Article } from \"@vuepress/plugin-blog/client\";\nimport { useBlogType } from \"@vuepress/plugin-blog/client\";\nimport type { ComputedRef, InjectionKey } from \"vue\";\nimport { computed, inject, provide } from \"vue\";\nimport { usePageLang } from \"vuepress/client\";\n\nimport type { ArticleInfoData } from \"../../../../shared/index.js\";\nimport { ArticleInfo } from \"../../../../shared/index.js\";\n\ndeclare const __VUEPRESS_DEV__: boolean;\n\nexport interface TimelineItem {\n  year: number;\n  items: { date: string; path: string; info: ArticleInfoData }[];\n}\n\nexport type TimelineRef = ComputedRef<{\n  path: string;\n  config: TimelineItem[];\n  items: Article<ArticleInfoData>[];\n}>;\n\nexport const timelineSymbol: InjectionKey<TimelineRef> = Symbol(\n  __VUEPRESS_DEV__ ? \"timeline\" : \"\",\n);\n\n/**\n * Inject timeline\n */\nexport const useTimeline = (): TimelineRef => {\n  const timeline = inject(timelineSymbol);\n\n  if (!timeline) throw new Error(\"useTimeline() is called without provider.\");\n\n  return timeline;\n};\n\n/**\n * Provide timelines\n */\nexport const setupTimeline = (): void => {\n  const timeline = useBlogType<ArticleInfoData>(\"timeline\");\n  const pageLang = usePageLang();\n\n  const timelineItems = computed(() => {\n    const timelineItems: TimelineItem[] = [];\n\n    // Filter before sort\n    timeline.value.items.forEach(({ info, path }) => {\n      const result = getDate(info[ArticleInfo.date]);\n\n      if (result) {\n        const year = result.getFullYear();\n\n        if (!timelineItems[0] || timelineItems[0].year !== year)\n          timelineItems.unshift({ year, items: [] });\n\n        timelineItems[0].items.push({\n          date: result.toLocaleDateString(pageLang.value, {\n            month: \"numeric\",\n            day: \"numeric\",\n          }),\n          info,\n          path,\n        });\n      }\n    });\n\n    return {\n      ...timeline.value,\n      config: timelineItems.reverse(),\n    };\n  });\n\n  provide(timelineSymbol, timelineItems);\n};\n"]}