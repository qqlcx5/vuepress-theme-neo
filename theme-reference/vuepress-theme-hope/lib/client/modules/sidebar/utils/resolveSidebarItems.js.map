{"version":3,"file":"resolveSidebarItems.js","sourceRoot":"","sources":["../../../../../src/client/modules/sidebar/utils/resolveSidebarItems.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  isArray,\n  isPlainObject,\n  isString,\n  keys,\n  startsWith,\n} from \"@vuepress/helper/client\";\nimport { resolveRoute } from \"vuepress/client\";\n\nimport { sidebarData } from \"@temp/theme-hope/sidebar.js\";\nimport {\n  isLinkInternal,\n  resolveLinkInfo,\n  resolvePrefix,\n} from \"@theme-hope/utils/index\";\n\nimport type {\n  SidebarGroupItem,\n  SidebarItem,\n  SidebarLinkItem,\n} from \"./typings.js\";\nimport type {\n  SidebarArrayOptions,\n  SidebarItemOptions,\n  SidebarObjectOptions,\n  SidebarOptions,\n} from \"../../../../shared/index.js\";\n\nexport interface SidebarArrayItem {\n  config: SidebarArrayOptions;\n  headerDepth: number;\n  prefix?: string;\n}\n\n/**\n * Resolve sidebar item\n */\nexport const resolveSidebarItem = (\n  item: SidebarItemOptions,\n  pathPrefix: string,\n): SidebarLinkItem | SidebarGroupItem => {\n  const config = isString(item)\n    ? resolveLinkInfo(resolvePrefix(pathPrefix, item))\n    : item.link\n      ? {\n          ...item,\n          link: isLinkInternal(item.link)\n            ? resolveRoute(resolvePrefix(pathPrefix, item.link)).path\n            : item.link,\n        }\n      : item;\n\n  // Resolved group item\n  if (\"children\" in config) {\n    const prefix = resolvePrefix(pathPrefix, config.prefix);\n\n    const children =\n      config.children === \"structure\" ? sidebarData[prefix] : config.children;\n\n    return {\n      ...config,\n      prefix,\n      children: children.map((item) => resolveSidebarItem(item, prefix)),\n    };\n  }\n\n  return {\n    ...config,\n  };\n};\n\n/**\n * Resolve sidebar items if the config is an array\n */\nexport const resolveArraySidebarItems = ({\n  config,\n  prefix = \"\",\n}: SidebarArrayItem): SidebarItem[] =>\n  config.map((item) => resolveSidebarItem(item, prefix));\n\nexport interface ResolveMultiSidebarOptions {\n  config: SidebarObjectOptions;\n  routePath: string;\n  headerDepth: number;\n}\n\n/**\n * Resolve sidebar items if the config is a key -> value (path-prefix -> array) object\n */\nexport const resolveMultiSidebarItems = ({\n  config,\n  routePath,\n  headerDepth,\n}: ResolveMultiSidebarOptions): SidebarItem[] => {\n  const sidebarRoutes = keys(config).sort((x, y) => y.length - x.length);\n\n  // Find matching config\n  for (const base of sidebarRoutes)\n    if (startsWith(decodeURI(routePath), base)) {\n      const matched = config[base];\n\n      return resolveArraySidebarItems({\n        config: matched === \"structure\" ? sidebarData[base] : matched || [],\n        headerDepth,\n        prefix: base,\n      });\n    }\n\n  console.warn(`${decodeURI(routePath)} is missing sidebar config.`);\n\n  return [];\n};\n\nexport interface ResolveSidebarOptions {\n  config: SidebarOptions;\n  headerDepth: number;\n  routeLocale: string;\n  routePath: string;\n}\n\n/**\n * Resolve sidebar items global computed\n *\n * It should only be resolved and provided once\n */\nexport const resolveSidebarItems = ({\n  config,\n  headerDepth,\n  routeLocale,\n  routePath,\n}: ResolveSidebarOptions): SidebarItem[] =>\n  // Resolve sidebar items according to the config\n  config === \"structure\"\n    ? resolveArraySidebarItems({\n        config: sidebarData[routeLocale],\n        headerDepth,\n        prefix: routeLocale,\n      })\n    : isArray(config)\n      ? resolveArraySidebarItems({ config, headerDepth })\n      : isPlainObject(config)\n        ? resolveMultiSidebarItems({ config, routePath, headerDepth })\n        : [];\n"]}